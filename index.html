<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ì—… ì°¸ì—¬ ë° í”¼ë“œë°±</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ë¡œë“œ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Inter í°íŠ¸ ê¸°ë³¸ ì ìš© */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        /* ìŠ¬ë¼ì´ë” ì§ˆë¬¸ í•­ëª© ìŠ¤íƒ€ì¼ */
        .survey-question {
            margin-bottom: 2rem; /* ì§ˆë¬¸ ê°„ ê°„ê²© */
        }
        .slider-label {
            display: block;
            text-align: left;
            font-size: 1.125rem; /* 18px */
            font-weight: 600; /* semibold */
            color: #1f2937; /* gray-800 */
            margin-bottom: 0.75rem; /* 12px */
        }
        .slider-emoji {
            font-size: 3rem; /* 48px */
            margin-bottom: 0.5rem; /* 8px */
            height: 50px; /* ì´ëª¨ì§€ ë†’ì´ ê³ ì • */
        }
        .slider-score {
            font-size: 1.5rem; /* 24px */
            font-weight: 700; /* bold */
            color: #2563EB; /* blue-600 */
            margin-bottom: 1rem; /* 16px */
            height: 30px; /* ì ìˆ˜ ë†’ì´ ê³ ì • */
        }
        .slider-legend {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem; /* 14px */
            color: #6b7280; /* gray-500 */
            margin-top: 0.5rem; /* 8px */
            padding: 0 0.25rem; /* 4px */
        }
        
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-start min-h-screen">

    <!-- ë§Œì¡±ë„ ì¡°ì‚¬ ì¹´ë“œ -->
    <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl text-center max-w-md w-full mx-4">
        
        <h1 class="text-xl md:text-2xl font-bold text-gray-800 mb-8">
            ì˜¤ëŠ˜ ìˆ˜ì—… í”¼ë“œë°±
        </h1>

        <!-- === ì§ˆë¬¸ 1 (ìŠ¬ë¼ì´ë”) === -->
        <div class="survey-question">
            <label class="slider-label" for="q1Slider">
                Q1. ì˜¤ëŠ˜ ìˆ˜ì—…ì— ì–´ë–»ê²Œ ì°¸ì—¬ í–ˆë‚˜ìš”?
            </label>
            <div id="q1Emoji" class="slider-emoji">ğŸ˜Š</div>
            <div id="q1Score" class="slider-score">5 / 10</div>
            <input 
                type="range" 
                id="q1Slider"
                min="1" max="10" value="5" 
                class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600 survey-slider"
                data-emoji-target="q1Emoji"
                data-score-target="q1Score"
            >
            <div class="slider-legend">
                <span>1ì  (ì†Œê·¹ì )</span>
                <span>10ì  (ì ê·¹ì )</span>
            </div>
        </div>

        <!-- === ì§ˆë¬¸ 2 (ìŠ¬ë¼ì´ë”) === -->
        <div class="survey-question">
            <label class="slider-label" for="q2Slider">
                Q2. Që“œëŸ¼ì˜ ê²‰ë„“ì´ì™€ ë¶€í”¼ë¥¼ êµ¬í•˜ëŠ” ë°©ë²•ì„ ì–¼ë§ˆë‚˜ ì´í•´í–ˆë‚˜ìš”?
            </label>
            <div id="q2Emoji" class="slider-emoji">ğŸ˜Š</div>
            <div id="q2Score" class="slider-score">5 / 10</div>
            <input 
                type="range" 
                id="q2Slider"
                min="1" max="10" value="5" 
                class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600 survey-slider"
                data-emoji-target="q2Emoji"
                data-score-target="q2Score"
            >
            <div class="slider-legend">
                <span>1ì  (ì´í•´ ëª»í•¨)</span>
                <span>10ì  (ì™„ë²½ ì´í•´)</span>
            </div>
        </div>

        <!-- === ì§ˆë¬¸ 3 (ìŠ¬ë¼ì´ë”) === -->
        <div class="survey-question">
            <label class="slider-label" for="q3Slider">
                Q3. 'íšŒì „ì²´'ë¥¼ ì‹¤ìƒí™œ(Që“œëŸ¼)ì— ì ìš©í•˜ëŠ” ê³¼ì •ì´ í¥ë¯¸ë¡œì› ë‚˜ìš”?
            </label>
            <div id="q3Emoji" class="slider-emoji">ğŸ˜Š</div>
            <div id="q3Score" class="slider-score">5 / 10</div>
            <input 
                type="range" 
                id="q3Slider"
                min="1" max="10" value="5" 
                class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600 survey-slider"
                data-emoji-target="q3Emoji"
                data-score-target="q3Score"
            >
            <div class="slider-legend">
                <span>1ì  (ì§€ë£¨í•¨)</span>
                <span>10ì  (ë§¤ìš° í¥ë¯¸ë¡œì›€)</span>
            </div>
        </div>

        <!-- === ì§ˆë¬¸ 4 (ì„œìˆ í˜• - ì ì •ê¸°ìˆ ) === -->
        <div class="survey-question">
            <label class="slider-label" for="comments_q4">
                Q4. Që“œëŸ¼ê³¼ ê°™ì€ ì ì • ê¸°ìˆ ì— ëŒ€í•œ ìì‹ ì˜ ìƒê°ì„ ê°„ë‹¨í•˜ê²Œ ì ì–´ì£¼ì„¸ìš”.
            </label>
            <textarea
                id="comments_q4"
                rows="4"
                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                placeholder="ì ì • ê¸°ìˆ ì— ëŒ€í•œ ìƒê°ì„ ì ì–´ì£¼ì„¸ìš”..."
            ></textarea>
        </div>

        <!-- === ì§ˆë¬¸ 5 (ì„œìˆ í˜• - ìˆ˜ì—… í”¼ë“œë°±) === -->
        <div class="survey-question">
            <label class="slider-label" for="comments_q5">
                Q5. ì˜¤ëŠ˜ ìˆ˜ì—…ì—ì„œ ì–´ë ¤ì› ë˜ ì ì´ë‚˜ í¥ë¯¸ë¡œì› ë˜ ì ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”.
            </label>
            <textarea
                id="comments_q5"
                rows="4"
                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                placeholder="ìˆ˜ì—…ì— ëŒ€í•œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..."
            ></textarea>
        </div>


        <!-- === ì œì¶œ ë²„íŠ¼ === -->
        <button id="submitButton" 
                class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mt-2
                       hover:bg-blue-700 transition duration-300
                       disabled:bg-gray-400 disabled:cursor-not-allowed">
            ì œì¶œí•˜ê¸°
        </button>
        <!-- === ìƒíƒœ ë©”ì‹œì§€ === -->
        <div id="statusMessage" class="text-sm text-gray-600 mt-4 h-5">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ -->
        </div>

    </div>

    <!-- === ì‹¤ì‹œê°„ ê²°ê³¼ íŒ¨ë„ (ê°œë³„ ëª©ë¡ ì œê±°ë¨) === -->
    <div id="resultsCard" class="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full mx-4 mt-6" style="display: none;"> 
        <h2 class="text-xl font-bold text-gray-800 mb-4">
            ì‹¤ì‹œê°„ í”¼ë“œë°± í˜„í™©
        </h2>
        
        <!-- í‰ê·  ì ìˆ˜ í‘œì‹œ ì˜ì—­ -->
        <div id="averageScoresContainer" class="mb-4">
            <p id="totalResponses" class="text-xl font-bold text-blue-600 mb-2">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                    <span class="text-sm font-semibold text-gray-600">Q1 ì°¸ì—¬ë„</span>
                    <p id="avgQ1" class="text-2xl font-bold text-gray-800">-</p>
                </div>
                <div>
                    <span class="text-sm font-semibold text-gray-600">Q2 ì´í•´ë„</span>
                    <p id="avgQ2" class="text-2xl font-bold text-gray-800">-</p>
                </div>
                <div>
                    <span class="text-sm font-semibold text-gray-600">Q3 í¥ë¯¸ë„</span>
                    <p id="avgQ3" class="text-2xl font-bold text-gray-800">-</p>
                </div>
            </div>
        </div>
        
        <!-- [ì‚­ì œë¨] ê°œë³„ ì‘ë‹µ ëª©ë¡ ì˜ì—­ì€ ì´ ìë¦¬ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. -->

    </div>


    <!-- Firebase SDK (ë°˜ë“œì‹œ type="module" ì‚¬ìš©) -->
   <script type="module">
    // Firebase SDK ëª¨ë“ˆ ì„í¬íŠ¸
    import { initializeApp } from "[https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js](https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js)";
    import { 
        getAuth, 
        signInAnonymously
    } from "[https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js](https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js)";
    import { 
        getFirestore, 
        collection, 
        addDoc, 
        serverTimestamp, 
        onSnapshot, 
        query
    } from "[https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js](https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js)";


    // [!!! ê°€ì¥ ì¤‘ìš” !!!]
    // 1ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ ì„ ìƒë‹˜ì˜ firebaseConfig ì½”ë“œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
   const firebaseConfig = {
  apiKey: "AIzaSyChU8wA8co0I30hGCn3jg6Nr8qdDRNf3Go",
  authDomain: "classfeedback-feec4.firebaseapp.com",
  projectId: "classfeedback-feec4",
  storageBucket: "classfeedback-feec4.firebasestorage.app",
  messagingSenderId: "304232184137",
  appId: "1:304232184137:web:99ed72f260ea6064d38298"
};


    // --- (ì´ ì•„ë˜ë¶€í„°ëŠ” ìˆ˜ì •í•˜ì§€ ë§ˆì„¸ìš”) ---

    // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° (ìŠ¬ë¼ì´ë” ê´€ë ¨)
    const sliders = document.querySelectorAll('.survey-slider');
    const commentsQ4Text = document.getElementById('comments_q4'); // (ì ì •ê¸°ìˆ )
    const commentsQ5Text = document.getElementById('comments_q5'); // (ìˆ˜ì—… í”¼ë“œë°±)

    // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° (ì œì¶œ/ê²°ê³¼ ê´€ë ¨)
    const submitButton = document.getElementById('submitButton');
    const statusMessage = document.getElementById('statusMessage');
    const resultsCard = document.getElementById('resultsCard');

    // í‰ê·  ì ìˆ˜ DOM ìš”ì†Œ
    const totalResponsesEl = document.getElementById('totalResponses');
    const avgQ1El = document.getElementById('avgQ1');
    const avgQ2El = document.getElementById('avgQ2');
    const avgQ3El = document.getElementById('avgQ3');

    // Firebase ë³€ìˆ˜
    let db, auth, userId;

    // [ìˆ˜ì •ë¨] 2ë‹¨ê³„ì˜ ë³´ì•ˆ ê·œì¹™ê³¼ ì¼ì¹˜í•˜ëŠ” ìƒˆ ì»¬ë ‰ì…˜ ê²½ë¡œ
    const collectionPath = 'responses'; 

    // --- í—¬í¼ í•¨ìˆ˜ ---
    function getEmoji(score) {
        const numScore = parseInt(score, 10);
        if (numScore >= 1 && numScore <= 4) return 'ğŸ˜”';
        else if (numScore >= 5 && numScore <= 8) return 'ğŸ˜Š';
        else return 'ğŸ˜';
    }

    function updateSlider(sliderElement) {
        const score = sliderElement.value;
        const emojiTargetId = sliderElement.dataset.emojiTarget;
        const scoreTargetId = sliderElement.dataset.scoreTarget;

        const emojiEl = document.getElementById(emojiTargetId);
        const scoreEl = document.getElementById(scoreTargetId);

        if (emojiEl) emojiEl.textContent = getEmoji(score);
        if (scoreEl) scoreEl.textContent = `${score} / 10`;

        if (emojiEl) {
            emojiEl.style.transform = 'scale(1.25)';
            setTimeout(() => {
                emojiEl.style.transform = 'scale(1)';
            }, 150);
        }
    }

    // --- Firebase ê´€ë ¨ í•¨ìˆ˜ ---

    // Firebase ì´ˆê¸°í™” ë° ì¸ì¦
    async function initializeFirebase() {
        try {
            // [ìˆ˜ì •ë¨] 1ë‹¨ê³„ì˜ firebaseConfigë¡œ ì•± ì´ˆê¸°í™”
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            resultsCard.style.display = 'block';

            // [ìˆ˜ì •ë¨] ìµëª…ìœ¼ë¡œë§Œ ë¡œê·¸ì¸ (ê°„ì†Œí™”)
            await signInAnonymously(auth);
            userId = auth.currentUser.uid;

            if (userId) {
                submitButton.disabled = false;
                statusMessage.textContent = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì™„ë£Œ";
                listenForResponses(); 
            }
        } catch (error) {
            console.error("Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
            statusMessage.textContent = "DB ì—°ê²° ì‹¤íŒ¨. F12ë¥¼ ëˆŒëŸ¬ ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.";
            totalResponsesEl.textContent = "ì˜¤ë¥˜: DB ì—°ê²° ì‹¤íŒ¨";
        }
    }

    // ì‘ë‹µ ì œì¶œ í•¨ìˆ˜
    async function submitResponse() {
        if (!db || !userId) {
            statusMessage.textContent = "ì•„ì§ DBì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
            return;
        }

        const q1Score = parseInt(document.getElementById('q1Slider').value, 10);
        const q2Score = parseInt(document.getElementById('q2Slider').value, 10);
        const q3Score = parseInt(document.getElementById('q3Slider').value, 10);
        const comments_q4 = commentsQ4Text.value.trim();
        const comments_q5 = commentsQ5Text.value.trim();

        submitButton.disabled = true;
        statusMessage.textContent = "ì œì¶œ ì¤‘...";

        try {
            // [ìˆ˜ì •ë¨] ìƒˆ ê²½ë¡œë¡œ ë°ì´í„° ì €ì¥
            await addDoc(collection(db, collectionPath), {
                q1Score: q1Score,
                q2Score: q2Score,
                q3Score: q3Score,
                comments_q4: comments_q4,
                comments_q5: comments_q5,
                submittedAt: serverTimestamp(), 
                submitterId: userId 
            });

            statusMessage.textContent = "ì œì¶œ ì™„ë£Œ! ê°ì‚¬í•©ë‹ˆë‹¤.";

            // (ì œì¶œ ì™„ë£Œ í›„ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™” - ì—¬ëŸ¬ ë²ˆ ì œì¶œ í—ˆìš©)
            setTimeout(() => {
                statusMessage.textContent = "ì‘ë‹µì„ ë‹¤ì‹œ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                submitButton.disabled = false;
            }, 2000);

        } catch (error) {
            console.error("Error adding document: ", error);
            statusMessage.textContent = "ì œì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
            submitButton.disabled = false;
        }
    }

    // ì‹¤ì‹œê°„ ê²°ê³¼ ìˆ˜ì‹  í•¨ìˆ˜ (ìµœì‹  ë²„ì „ê³¼ ë™ì¼)
    function listenForResponses() {
        // [ìˆ˜ì •ë¨] ìƒˆ ê²½ë¡œì—ì„œ ë°ì´í„° ìˆ˜ì‹ 
        const q = query(collection(db, collectionPath));

        onSnapshot(q, (querySnapshot) => {
            let responsesCount = 0;
            let totalQ1Score = 0; 
            let totalQ2Score = 0;
            let totalQ3Score = 0;

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                if (data.submittedAt && 
                    data.q1Score !== undefined &&
                    data.q2Score !== undefined &&
                    data.q3Score !== undefined) 
                {
                    responsesCount++;
                    totalQ1Score += data.q1Score;
                    totalQ2Score += data.q2Score;
                    totalQ3Score += data.q3Score;
                }
            });

            if (responsesCount > 0) {
                const avgQ1 = (totalQ1Score / responsesCount).toFixed(1);
                const avgQ2 = (totalQ2Score / responsesCount).toFixed(1);
                const avgQ3 = (totalQ3Score / responsesCount).toFixed(1);

                totalResponsesEl.textContent = `ì´ ${responsesCount}ê°œ ì‘ë‹µ`;
                avgQ1El.textContent = avgQ1;
                avgQ2El.textContent = avgQ2;
                avgQ3El.textContent = avgQ3;

            } else {
                totalResponsesEl.textContent = "ì•„ì§ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.";
                avgQ1El.textContent = "-";
                avgQ2El.textContent = "-";
                avgQ3El.textContent = "-";
            }
        }, (error) => {
            console.error("ì‹¤ì‹œê°„ ìˆ˜ì‹  ì˜¤ë¥˜: ", error);
            totalResponsesEl.textContent = "ê²°ê³¼ ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ";
        });
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---
    sliders.forEach(slider => {
        slider.addEventListener('input', () => updateSlider(slider));
        document.addEventListener('DOMContentLoaded', () => updateSlider(slider));
    });

    submitButton.addEventListener('click', submitResponse);

    document.addEventListener('DOMContentLoaded', () => {
        submitButton.disabled = true; 
        statusMessage.textContent = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘...";
        initializeFirebase(); 
    });
</script></body>
</html>
